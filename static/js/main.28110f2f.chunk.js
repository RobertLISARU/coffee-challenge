(this["webpackJsonpcoffee-challenge"]=this["webpackJsonpcoffee-challenge"]||[]).push([[0],{20:function(t,e,n){},21:function(t,e,n){},25:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(11),o=n.n(i),s=(n(20),n(14)),c=n(5),u=n(6),l=n(7),d=n(15),h=n(13),p=n(2),b=(n(21),n(1)),j=function(t){var e=t.isVisible,n=t.name,a=t.distance;return e?Object(b.jsxs)("div",{className:"shopTooltip",children:[Object(b.jsx)("p",{children:n}),Object(b.jsx)("p",{children:a})]}):null},f={LOADING:0,ERROR:1,AVAILABLE:2,EMPTY:3};Object.freeze(f);var O=f,v=function(){function t(){Object(c.a)(this,t),this.dataState=O.LOADING,this.data=null,this.error=null}return Object(u.a)(t,[{key:"setData",value:function(t){t&&0!=t.length?this.dataState=O.AVAILABLE:this.dataState=O.EMPTY,this.data=t}},{key:"setError",value:function(t){this.dataState=O.ERROR,this.error=t}}]),t}(),x=n(23),g=function(t){Object(d.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(c.a)(this,n),(a=e.call(this,t)).state={shopTooltipsVisibility:[],userTooltipVisibility:!1},a.toggleTooltipVisibility=a.toggleTooltipVisibility.bind(Object(l.a)(a)),a}return Object(u.a)(n,[{key:"render",value:function(){var t=this.props,e=t.shops,n=t.userLocation;return Object(b.jsxs)(p.a,{provider:this.osmProvider,defaultCenter:[45.795,24.147],defaultZoom:4,width:600,height:400,children:[this.createShopMarkers(e),this.createShopTooltips(e),this.createUserMarker(n),this.createUserTooltip(n)]})}},{key:"toggleTooltipVisibility",value:function(t){var e=t.payload,n=Object(s.a)(this.state.shopTooltipsVisibility);n[e]=!n[e],this.setState({shopTooltipsVisibility:n})}},{key:"createShopMarkers",value:function(t){var e=this;return t.dataState==O.AVAILABLE?t.data.map((function(t){return Object(b.jsx)(p.b,{anchor:[parseFloat(t.x),parseFloat(t.y)],color:"black",payload:t.id,onClick:e.toggleTooltipVisibility},t.id)})):null}},{key:"createShopTooltips",value:function(t){var e=this;return t.dataState==O.AVAILABLE?t.data.map((function(t){return Object(b.jsx)(p.c,{anchor:[parseFloat(t.x),parseFloat(t.y)],children:Object(b.jsx)(j,{isVisible:e.state.shopTooltipsVisibility[t.id],name:t.name,distance:e.computeDistanceFromUserTo({latitude:t.x,longitude:t.y})})},t.id)})):null}},{key:"createUserMarker",value:function(t){var e=this;return t.dataState==O.AVAILABLE?Object(b.jsx)(p.b,{anchor:[t.data.latitude,t.data.longitude],color:"red",payload:"user",onClick:function(){e.setState((function(t){return{userTooltipVisibility:!t.userTooltipVisibility}}))}}):null}},{key:"createUserTooltip",value:function(t){return t.dataState==O.AVAILABLE?Object(b.jsx)(p.c,{anchor:[t.data.latitude,t.data.longitude],children:Object(b.jsx)(j,{isVisible:this.state.userTooltipVisibility,name:"Your location",distance:null})}):null}},{key:"computeDistanceFromUserTo",value:function(t){var e=t.latitude,n=t.longitude;return this.props.userLocation.dataState==O.AVAILABLE?Math.round(10*x({latitude:this.props.userLocation.data.latitude,longitude:this.props.userLocation.data.longitude},{latitude:e,longitude:n}))/10+" km":"Locating..."}},{key:"osmProvider",value:function(t,e,n){var a=String.fromCharCode(97+(t+e+n)%3);return"https://".concat(a,".tile.openstreetmap.org/").concat(n,"/").concat(t,"/").concat(e,".png")}}]),n}(r.a.Component),L=function(){return Object(b.jsx)("div",{children:"Locating..."})},y=function(t){return Object(b.jsxs)("div",{children:["Error: ",t]})},A=function(t){var e=t.userLocation;switch(e.dataState){case O.LOADING:return L();case O.ERROR:return y(e.error);case O.AVAILABLE:return Object(b.jsxs)("div",{children:["Your location: ",e.data.latitude,", ",e.data.longitude]})}},k=function(t){return Object(b.jsxs)("p",{children:["Could not fetch shop locations. ",t.code," ",t.text]})},m=function(){return Object(b.jsx)("p",{children:"No shops"})},S=function(){return Object(b.jsx)("p",{children:"Fetching coffee shop list"})},T=function(t){var e=t.coffeeShops;switch(e.dataState){case O.LOADING:return S();case O.ERROR:return k(e.error);case O.EMPTY:return m();case O.AVAILABLE:return Object(b.jsxs)("ul",{children:[Object(b.jsx)("h2",{children:"Coffee Shops"}),e.data.map((function(t){return Object(b.jsxs)("li",{children:[t.name,Object(b.jsx)("br",{}),t.x,Object(b.jsx)("br",{}),t.y,Object(b.jsx)("br",{})]},t.id)}))]})}},E=n(8),V=function(){var t=Object(a.useState)(new v),e=Object(E.a)(t,2),n=e[0],r=e[1],i=function(t){var e=t.coords,n=new v;n.setData({latitude:e.latitude,longitude:e.longitude}),r(n)},o=function(t){var e=new v;e.setError(t.message),r(e)};return Object(a.useEffect)((function(){var t=navigator.geolocation,e=null;if(t)e=t.watchPosition(i,o);else{var n=new v;n.setError("Geolocation is not supported"),r(n)}return function(){return t.clearWatch(e)}}),[]),n},I=n(10),w=n.n(I),R=n(12),B=function(){var t=Object(a.useState)(new v),e=Object(E.a)(t,2),n=e[0],r=e[1],i=function(){var t=Object(R.a)(w.a.mark((function t(){var e,n,a,i;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://blue-bottle-api-test.herokuapp.com/v1/tokens",{method:"POST"});case 2:return e=t.sent,t.next=5,e.json();case 5:return n=t.sent,t.next=8,fetch("https://blue-bottle-api-test.herokuapp.com/v1/coffee_shops?token=".concat(n.token));case 8:a=t.sent,i=new v,t.t0=a.status,t.next=200===t.t0?13:19;break;case 13:return t.t1=i,t.next=16,a.json();case 16:return t.t2=t.sent,t.t1.setData.call(t.t1,t.t2),t.abrupt("break",20);case 19:i.setError({code:a.status,text:a.statusText});case 20:r(i);case 21:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(a.useEffect)((function(){i()}),[]),n};var C=function(){var t=V(),e=B();return Object(b.jsxs)("div",{children:[Object(b.jsx)(g,{shops:e,userLocation:t}),Object(b.jsx)(A,{userLocation:t}),Object(b.jsx)(T,{coffeeShops:e})]})},F=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,i=e.getLCP,o=e.getTTFB;n(t),a(t),r(t),i(t),o(t)}))};o.a.render(Object(b.jsx)(r.a.StrictMode,{children:Object(b.jsx)(C,{})}),document.getElementById("root")),F()}},[[25,1,2]]]);
//# sourceMappingURL=main.28110f2f.chunk.js.map